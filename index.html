<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CopyStack - Advanced Clipboard Tool</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>CopyStack</h1>
        <p class="subtitle">Advanced Clipboard Stacking Tool</p>
        
        <div class="section status-section">
            <h2>Setup Required</h2>
            <div class="setup-warning">
                <h3>Accessibility Permission Required</h3>
                <p><strong>CopyStack needs accessibility permissions to capture selected text.</strong></p>
                <ol>
                    <li>Open <strong>System Settings</strong> (or System Preferences)</li>
                    <li>Go to <strong>Privacy & Security</strong> ‚Üí <strong>Accessibility</strong></li>
                    <li>Find <strong>CopyStack</strong> in the list and enable it</li>
                    <li>If CopyStack isn't listed, click the <strong>+</strong> button and add it</li>
                    <li>Restart CopyStack after granting permission</li>
                </ol>
                <p><em>Without this permission, the Cmd+Shift+C shortcut won't work properly.</em></p>
            </div>
        </div>
        
        <div class="section status-section">
            <h2>How CopyStack Works</h2>
            <div class="how-it-works">
                <div class="step-item">
                    <span class="step-number">1</span>
                    <div class="step-content">
                        <strong>Select text anywhere</strong>
                        <p>Highlight text in any app, website, or document</p>
                    </div>
                </div>
                <div class="step-item">
                    <span class="step-number">2</span>
                    <div class="step-content">
                        <strong>Press Cmd+Shift+C</strong>
                        <p>Advanced append mode - builds your clipboard stack</p>
                    </div>
                </div>
                <div class="step-item">
                    <span class="step-number">3</span>
                    <div class="step-content">
                        <strong>Keep stacking</strong>
                        <p>Collect text from multiple sources effortlessly</p>
                    </div>
                </div>
                <div class="step-item">
                    <span class="step-number">4</span>
                    <div class="step-content">
                        <strong>Paste your stack</strong>
                        <p>Use Cmd+V to paste all collected text at once</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
            <div class="shortcuts">
                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>Cmd</kbd> + <kbd>C</kbd>
                        <span class="mac-text">(Ctrl+C on Windows)</span>
                    </div>
                    <span>Normal copy - replaces clipboard (unchanged)</span>
                </div>
                <div class="shortcut-item primary-shortcut">
                    <div class="shortcut-keys">
                        <kbd>Cmd</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd>
                        <span class="mac-text">(Ctrl+Shift+C on Windows)</span>
                    </div>
                    <span>Advanced append - builds your clipboard stack</span>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üß™ Test CopyStack Now</h2>
            <p><strong>Try the advanced clipboard stacking:</strong></p>
            <div class="test-texts">
                <div class="test-text" onclick="selectText(this)">Research finding #1: Lorem ipsum dolor sit amet</div>
                <div class="test-text" onclick="selectText(this)">Research finding #2: Consectetur adipiscing elit</div>
                <div class="test-text" onclick="selectText(this)">Research finding #3: Sed do eiusmod tempor incididunt</div>
            </div>
            <div class="test-instructions">
                <p><strong>Power User Instructions:</strong></p>
                <ol>
                    <li>Click "Research finding #1" to select it</li>
                    <li>Press <strong>Cmd+C</strong> to copy normally</li>
                    <li>Click "Research finding #2" to select it</li>
                    <li>Press <strong>Cmd+Shift+C</strong> to append to stack</li>
                    <li>Click "Research finding #3" and press <strong>Cmd+Shift+C</strong> again</li>
                    <li>Check your clipboard below - you should see all findings!</li>
                </ol>
            </div>
        </div>
        
        <div class="section">
            <h2>üìã Current Clipboard Stack</h2>
            <textarea id="clipboardContent" readonly placeholder="Your clipboard stack will appear here..."></textarea>
            <div class="clipboard-controls">
                <button id="refreshClipboard">üîÑ Refresh Stack</button>
                <button id="clearClipboard">üóëÔ∏è Clear Stack</button>
            </div>
        </div>
        
        <div class="section">
            <h2>üí° Perfect For Power Users</h2>
            <ul>
                <li><strong>Researchers:</strong> Stack quotes and citations from multiple sources</li>
                <li><strong>Writers:</strong> Build comprehensive notes and references</li>
                <li><strong>Developers:</strong> Collect code snippets and documentation</li>
                <li><strong>Students:</strong> Compile research for academic papers</li>
                <li><strong>Professionals:</strong> Build reports from multiple data sources</li>
                <li><strong>Content Creators:</strong> Gather inspiration from various platforms</li>
            </ul>
        </div>
        
        <div class="section">
            <h2>Background Service</h2>
            <p>CopyStack runs as a background service in your menu bar. The Cmd+Shift+C shortcut works system-wide in any application - browsers, editors, PDFs, anywhere you can select text!</p>
            <p>Close this window anytime - CopyStack continues running in the background.</p>
            <div class="controls">
                <button id="hideWindow">Hide Settings Window</button>
                <button id="checkPermissions">Check Permission Status</button>
                <button id="openAccessibilitySettings">Open Accessibility Settings</button>
            </div>
        </div>
        
        <div class="footer">
            <p>CopyStack v1.0 - Professional productivity tool for power users</p>
        </div>
    </div>

    <script>
        const { clipboard, ipcRenderer } = require('electron');
        const { systemPreferences } = require('electron');
        
        const clipboardTextarea = document.getElementById('clipboardContent');
        const refreshBtn = document.getElementById('refreshClipboard');
        const clearBtn = document.getElementById('clearClipboard');
        const hideBtn = document.getElementById('hideWindow');
        const checkPermissionsBtn = document.getElementById('checkPermissions');
        const openSettingsBtn = document.getElementById('openAccessibilitySettings');
        
        function updateClipboardDisplay() {
            const clipText = clipboard.readText();
            clipboardTextarea.value = clipText || 'Clipboard stack is empty - try the test above!';
        }
        
        function selectText(element) {
            const selection = window.getSelection();
            const range = document.createRange();
            range.selectNodeContents(element);
            selection.removeAllRanges();
            selection.addRange(range);
        }
        
        function checkAccessibilityPermission() {
            if (process.platform === 'darwin') {
                const hasPermission = systemPreferences.isTrustedAccessibilityClient(false);
                if (hasPermission) {
                    alert('‚úÖ Accessibility permission is granted! CopyStack should work properly.');
                } else {
                    alert('‚ùå Accessibility permission is NOT granted.\n\nPlease use the "Open Accessibility Settings" button to grant permission, then restart CopyStack.');
                }
            } else {
                alert('Accessibility permissions are not required on this platform.');
            }
        }
        
        function openAccessibilitySettings() {
            if (process.platform === 'darwin') {
                require('child_process').exec('open "x-apple.systempreferences:com.apple.preference.security?Privacy_Accessibility"');
            } else if (process.platform === 'win32') {
                require('child_process').exec('ms-settings:easeofaccess');
            } else {
                // Linux
                require('child_process').exec('gnome-control-center universal-access || unity-control-center universal-access || systemsettings5 kcm_accessibility');
            }
        }
        
        refreshBtn.addEventListener('click', updateClipboardDisplay);
        
        clearBtn.addEventListener('click', () => {
            clipboard.clear();
            updateClipboardDisplay();
        });
        
        hideBtn.addEventListener('click', () => {
            window.close();
        });
        
        checkPermissionsBtn.addEventListener('click', checkAccessibilityPermission);
        
        openSettingsBtn.addEventListener('click', openAccessibilitySettings);
        
        // Update clipboard display on load
        updateClipboardDisplay();
        
        // Auto-refresh every 2 seconds  
        setInterval(updateClipboardDisplay, 2000);
    </script>
</body>
</html>